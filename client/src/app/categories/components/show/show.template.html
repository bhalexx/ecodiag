@if (category$|async; as category) {
    <h1>{{ category.icon }}{{ category.name }}</h1>
    <p>{{ category.description }}</p>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <ng-template [ngTemplateOutlet]="buttonsTpl" />

        Progression :
        <progress [value]="progress" max="100"></progress>

        <!-- To delete -->
        <button type="button" (click)="forceCompletion()">Compl√©ter</button>

        @for (criterion of category.criteria; track $index) {
            <article>
                <header>
                    <mark>{{ category.id }}.{{ $index + 1 }}</mark> {{ criterion.label }}
                </header>

                <criteria-status [formControlName]="'criterion_' + criterion.id"
                                 [criterion]="{id: criterion.id, status: null}"
                                 [groupName]="'criterion_' + criterion.id"
                                 (valueChange)="change($event)" />

                <footer>
                    <details>
                        <summary class="pointer">
                            <strong>üéØ Objectifs, mise en ≈ìuvre et moyens de contr√¥le</strong>&nbsp;<small>(cliquez pour d√©plier)</small>
                        </summary>
                        <br/>
                        <strong>Objectifs</strong>
                        <blockquote [innerHTML]="criterion.purpose"></blockquote>

                        <strong>Mise en ≈ìuvre</strong>
                        <blockquote [innerHTML]="criterion.implementation"></blockquote>

                        <strong>Moyen de test ou de contr√¥le</strong>
                        <blockquote [innerHTML]="criterion.testing"></blockquote>

                        üîó <a href="https://ecoresponsable.numerique.gouv.fr/publications/referentiel-general-ecoconception/critere/{{ category.id }}.{{ $index + 1 }}" target="_blank">Lien</a>
                    </details>
                </footer>
            </article>
        }

        @if (0 < progress) {
            <article>
                Le niveau de conformit√© pour cette cat√©gorie est de :
                <mark>{{ score|number: '1.0-0' }} %</mark>
            </article>
        }

        <ng-template [ngTemplateOutlet]="buttonsTpl" />
    </form>
}

<ng-template #buttonsTpl>
    <div role="group">
        @if (previous) {
            <a routerLink="/categorie/{{ previous}}" role="button" class="primary">Cat√©gorie pr√©c√©dente</a>
        }
        @if (hasNext) {
            <a routerLink="/" role="button" class="secondary">Retour √† la liste</a>
            <button type="submit">Cat√©gorie suivante</button>
        } @else {
            <button type="submit">Sauver et revenir √† la liste</button>
        }
    </div>
</ng-template>
